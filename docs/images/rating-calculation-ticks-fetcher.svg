<svg xmlns="http://www.w3.org/2000/svg" width="2331.9296875" height="974"><style xmlns="http://www.w3.org/1999/xhtml" type="text/css">
svg text {
  fill: #000;
  stroke: none;
  font-size: 12pt;
  font-family: 'Andale Mono', monospace;
}

svg :not(text) {
  fill: none;
  stroke: #000;
  stroke-width: 2;
}

.textbg {
  fill: #fff;
  stroke: none;
}

.rect {
  fill: #fff;
}

.signal-solid {
  stroke-dasharray: 0;
}

.signal-dotted {
  stroke-dasharray: 5;
}

.arrow-filled {
  marker-end: url(#arrow-filled);
}

.arrow-open {
  marker-end: url(#arrow-open);
}
</style><defs><marker id="arrow-filled" refX="5" refY="2.5" markerWidth="5" markerHeight="5" orient="auto"><path d="M0,0 5,2.5 0,5z" style="stroke: none; fill: #000"/></marker><marker id="arrow-open" refX="5" refY="2.5" markerWidth="5" markerHeight="5" orient="auto"><path d="M0,0 5,2.5 0,5" style="stroke-width: 1"/></marker></defs><rect width="413.65625" height="28" x="10" y="10" class="rect"/><text x="216.828125" y="24" style="text-anchor: middle; alignment-baseline: central;">Rating calculations service - tick fetcher</text><rect width="97.203125" height="38" x="10" y="48" class="rect"/><text x="58.6015625" y="67" style="text-anchor: middle; alignment-baseline: central;">Scheduler</text><rect width="97.203125" height="38" x="10" y="916" class="rect"/><text x="58.6015625" y="935" style="text-anchor: middle; alignment-baseline: central;">Scheduler</text><path d="M58.6015625,86 v830" class="timeline"/><rect width="97.203125" height="38" x="318.046875" y="48" class="rect"/><text x="366.6484375" y="67" style="text-anchor: middle; alignment-baseline: central;">Database</text><rect width="97.203125" height="38" x="318.046875" y="916" class="rect"/><text x="366.6484375" y="935" style="text-anchor: middle; alignment-baseline: central;">Database</text><path d="M366.6484375,86 v830" class="timeline"/><rect width="78" height="38" x="472.0703125" y="48" class="rect"/><text x="511.0703125" y="67" style="text-anchor: middle; alignment-baseline: central;">Config</text><rect width="78" height="38" x="472.0703125" y="916" class="rect"/><text x="511.0703125" y="935" style="text-anchor: middle; alignment-baseline: central;">Config</text><path d="M511.0703125,86 v830" class="timeline"/><rect width="68.40625" height="38" x="570.0703125" y="48" class="rect"/><text x="604.2734375" y="67" style="text-anchor: middle; alignment-baseline: central;">Queue</text><rect width="68.40625" height="38" x="570.0703125" y="916" class="rect"/><text x="604.2734375" y="935" style="text-anchor: middle; alignment-baseline: central;">Queue</text><path d="M604.2734375,86 v830" class="timeline"/><rect width="79" height="38" x="1096.0703125" y="48" class="rect"/><text x="1135.5703125" y="67" style="text-anchor: middle; alignment-baseline: central;">Worker</text><rect width="79" height="38" x="1096.0703125" y="916" class="rect"/><text x="1135.5703125" y="935" style="text-anchor: middle; alignment-baseline: central;">Worker</text><path d="M1135.5703125,86 v830" class="timeline"/><rect width="231.625" height="38" x="1789.8671875" y="48" class="rect"/><text x="1905.6796875" y="67" style="text-anchor: middle; alignment-baseline: central;">History rates provider</text><rect width="231.625" height="38" x="1789.8671875" y="916" class="rect"/><text x="1905.6796875" y="935" style="text-anchor: middle; alignment-baseline: central;">History rates provider</text><path d="M1905.6796875,86 v830" class="timeline"/><rect width="260.4375" height="38" x="2041.4921875" y="48" class="rect"/><text x="2171.7109375" y="67" style="text-anchor: middle; alignment-baseline: central;">Currency converter worker</text><rect width="260.4375" height="38" x="2041.4921875" y="916" class="rect"/><text x="2171.7109375" y="935" style="text-anchor: middle; alignment-baseline: central;">Currency converter worker</text><path d="M2171.7109375,86 v830" class="timeline"/><rect width="288.046875" height="18" x="68.59375" y="102" class="textbg"/><text x="212.625" y="111" style="text-anchor: middle; alignment-baseline: central;">Getting the list of valid keys</text><path d="M58.6015625,124 h308.046875" class="signal-solid arrow-filled"/><rect width="249.640625" height="18" x="87.796875" y="140" class="textbg"/><text x="212.625" y="149" style="text-anchor: middle; alignment-baseline: central;">List of (keys, stock name)</text><path d="M366.6484375,162 h-308.046875" class="signal-solid arrow-filled"/><rect width="432.46875" height="18" x="68.796875" y="178" class="textbg"/><text x="284.8359375" y="187" style="text-anchor: middle; alignment-baseline: central;">Getting the list of base currencies for stock</text><path d="M58.6015625,200 h452.46875" class="signal-solid arrow-filled"/><rect width="0" height="0" x="0" y="0" class="textbg"/><text x="284.8359375" y="225" style="text-anchor: middle; alignment-baseline: central;"/><path d="M511.0703125,220 h-452.46875" class="signal-solid arrow-filled"/><rect width="489.671875" height="18" x="86.59375" y="236" class="textbg"/><text x="331.4375" y="245" style="text-anchor: middle; alignment-baseline: central;">Creating jobs for processing (key, stock, currency)</text><path d="M58.6015625,258 h545.671875" class="signal-solid arrow-filled"/><rect width="374.859375" height="18" x="682.6875" y="274" class="textbg"/><text x="869.921875" y="283" style="text-anchor: middle; alignment-baseline: central;">Spawning the (key, stock, currency) job</text><path d="M604.2734375,296 h531.296875" class="signal-solid arrow-filled"/><rect width="700.90625" height="18" x="400.640625" y="312" class="textbg"/><text x="751.109375" y="321" style="text-anchor: middle; alignment-baseline: central;">Getting the list of balances, where ticks were not checked for `currency`</text><path d="M1135.5703125,334 h-768.921875" class="signal-solid arrow-filled"/><rect width="249.640625" height="18" x="626.28125" y="350" class="textbg"/><text x="751.109375" y="359" style="text-anchor: middle; alignment-baseline: central;">List of unchecked balances</text><path d="M366.6484375,372 h768.921875" class="signal-solid arrow-filled"/><rect width="586.09375" height="18" x="458.25" y="388" class="textbg"/><text x="751.109375" y="397" style="text-anchor: middle; alignment-baseline: central;">Getting the closest tick for each currency in balance's state</text><path d="M1135.5703125,410 h-768.921875" class="signal-solid arrow-filled"/><rect width="298.4375" height="28" x="1155.5703125" y="430" class="rect"/><text x="1304.7890625" y="444" style="text-anchor: middle; alignment-baseline: central;">should be placed in 1 hour gap</text><rect width="586.09375" height="18" x="458.25" y="474" class="textbg"/><text x="751.109375" y="483" style="text-anchor: middle; alignment-baseline: central;">If ticks exists - return the price, otherwise returns nothing</text><path d="M366.6484375,496 h768.921875" class="signal-solid arrow-filled"/><rect width="317.25" height="18" x="1160.765625" y="516" class="textbg"/><text x="1319.1953125" y="525" style="text-anchor: middle; alignment-baseline: central;">Checking that the tick is correct</text><path d="M1135.5703125,511 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="730.109375" height="28" x="1155.5703125" y="554" class="rect"/><text x="1520.625" y="568" style="text-anchor: middle; alignment-baseline: central;">&lt;condition-start&gt; If there's no correct tick for specific (pair, timestamp)</text><rect width="730.109375" height="18" x="1155.765625" y="598" class="textbg"/><text x="1520.625" y="607" style="text-anchor: middle; alignment-baseline: central;">Query X ticks for pair in (timestamp - Y seconds, timestamp + Y seconds) gap</text><path d="M1135.5703125,620 h770.109375" class="signal-solid arrow-filled"/><rect width="307.640625" height="18" x="1367" y="636" class="textbg"/><text x="1520.625" y="645" style="text-anchor: middle; alignment-baseline: central;">Returns the list of ticks in gap</text><path d="M1905.6796875,658 h-770.109375" class="signal-solid arrow-filled"/><rect width="566.890625" height="18" x="1160.765625" y="678" class="textbg"/><text x="1444.015625" y="687" style="text-anchor: middle; alignment-baseline: central;">Checking that the returned list includes the necessary tick</text><path d="M1135.5703125,673 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="240.03125" height="18" x="631.078125" y="712" class="textbg"/><text x="751.109375" y="721" style="text-anchor: middle; alignment-baseline: central;">Saving the received ticks</text><path d="M1135.5703125,734 h-768.921875" class="signal-solid arrow-filled"/><rect width="154.015625" height="28" x="1155.5703125" y="754" class="rect"/><text x="1232.578125" y="768" style="text-anchor: middle; alignment-baseline: central;">&lt;condition-end&gt;</text><rect width="748.921875" height="18" x="376.640625" y="798" class="textbg"/><text x="751.109375" y="807" style="text-anchor: middle; alignment-baseline: central;">Updating the balance's flag (means `ticks for (state, currency) were checked`)</text><path d="M1135.5703125,820 h-768.921875" class="signal-solid arrow-none"/><rect width="548.28125" height="18" x="1378.984375" y="836" class="textbg"/><text x="1653.640625" y="845" style="text-anchor: middle; alignment-baseline: central;">Adding job for converting current balance into `currency`</text><path d="M1135.5703125,858 h1036.140625" class="signal-solid arrow-filled"/><rect width="519.484375" height="18" x="1160.0625" y="878" class="textbg"/><text x="1420.3125" y="887" style="text-anchor: middle; alignment-baseline: central;">Adding same job, so the next balance will be processed</text><path d="M1135.5703125,873 h20 v33 h-20" class="signal-solid arrow-filled"/></svg>
