<svg xmlns="http://www.w3.org/2000/svg" width="2198.5" height="862"><style xmlns="http://www.w3.org/1999/xhtml" type="text/css">
svg text {
  fill: #000;
  stroke: none;
  font-size: 12pt;
  font-family: 'Andale Mono', monospace;
}

svg :not(text) {
  fill: none;
  stroke: #000;
  stroke-width: 2;
}

.textbg {
  fill: #fff;
  stroke: none;
}

.rect {
  fill: #fff;
}

.signal-solid {
  stroke-dasharray: 0;
}

.signal-dotted {
  stroke-dasharray: 5;
}

.arrow-filled {
  marker-end: url(#arrow-filled);
}

.arrow-open {
  marker-end: url(#arrow-open);
}
</style><defs><marker id="arrow-filled" refX="5" refY="2.5" markerWidth="5" markerHeight="5" orient="auto"><path d="M0,0 5,2.5 0,5z" style="stroke: none; fill: #000"/></marker><marker id="arrow-open" refX="5" refY="2.5" markerWidth="5" markerHeight="5" orient="auto"><path d="M0,0 5,2.5 0,5" style="stroke-width: 1"/></marker></defs><rect width="586.09375" height="28" x="10" y="10" class="rect"/><text x="303.046875" y="24" style="text-anchor: middle; alignment-baseline: central;">Balances fetcher service - loading balances for active pairs</text><rect width="97.203125" height="38" x="10" y="48" class="rect"/><text x="58.6015625" y="67" style="text-anchor: middle; alignment-baseline: central;">Scheduler</text><rect width="97.203125" height="38" x="10" y="804" class="rect"/><text x="58.6015625" y="823" style="text-anchor: middle; alignment-baseline: central;">Scheduler</text><path d="M58.6015625,86 v718" class="timeline"/><rect width="97.203125" height="38" x="606.484375" y="48" class="rect"/><text x="655.0859375" y="67" style="text-anchor: middle; alignment-baseline: central;">Database</text><rect width="97.203125" height="38" x="606.484375" y="804" class="rect"/><text x="655.0859375" y="823" style="text-anchor: middle; alignment-baseline: central;">Database</text><path d="M655.0859375,86 v718" class="timeline"/><rect width="68.40625" height="38" x="723.6875" y="48" class="rect"/><text x="757.890625" y="67" style="text-anchor: middle; alignment-baseline: central;">Queue</text><rect width="68.40625" height="38" x="723.6875" y="804" class="rect"/><text x="757.890625" y="823" style="text-anchor: middle; alignment-baseline: central;">Queue</text><path d="M757.890625,86 v718" class="timeline"/><rect width="79" height="38" x="1411.5" y="48" class="rect"/><text x="1451" y="67" style="text-anchor: middle; alignment-baseline: central;">Worker</text><rect width="79" height="38" x="1411.5" y="804" class="rect"/><text x="1451" y="823" style="text-anchor: middle; alignment-baseline: central;">Worker</text><path d="M1451,86 v718" class="timeline"/><rect width="145.21875" height="38" x="2023.28125" y="48" class="rect"/><text x="2095.890625" y="67" style="text-anchor: middle; alignment-baseline: central;">Stock wrapper</text><rect width="145.21875" height="38" x="2023.28125" y="804" class="rect"/><text x="2095.890625" y="823" style="text-anchor: middle; alignment-baseline: central;">Stock wrapper</text><path d="M2095.890625,86 v718" class="timeline"/><rect width="288.046875" height="18" x="212.8125" y="102" class="textbg"/><text x="356.84375" y="111" style="text-anchor: middle; alignment-baseline: central;">Getting the list of valid keys</text><path d="M58.6015625,124 h596.484375" class="signal-solid arrow-filled"/><rect width="249.640625" height="18" x="232.015625" y="140" class="textbg"/><text x="356.84375" y="149" style="text-anchor: middle; alignment-baseline: central;">List of (keys, stock name)</text><path d="M655.0859375,162 h-596.484375" class="signal-solid arrow-filled"/><rect width="576.484375" height="18" x="68.796875" y="178" class="textbg"/><text x="356.84375" y="187" style="text-anchor: middle; alignment-baseline: central;">Getting the list of active (pairs, currencies) for each user</text><path d="M58.6015625,200 h596.484375" class="signal-solid arrow-filled"/><rect width="0" height="0" x="0" y="0" class="textbg"/><text x="356.84375" y="225" style="text-anchor: middle; alignment-baseline: central;"/><path d="M655.0859375,220 h-596.484375" class="signal-solid arrow-filled"/><rect width="576.09375" height="18" x="120.1875" y="236" class="textbg"/><text x="408.24609375" y="245" style="text-anchor: middle; alignment-baseline: central;">Creating jobs for processing (key, stock, pairs, currencies)</text><path d="M58.6015625,258 h699.2890625" class="signal-solid arrow-filled"/><rect width="461.265625" height="18" x="874" y="274" class="textbg"/><text x="1104.4453125" y="283" style="text-anchor: middle; alignment-baseline: central;">Spawning the (key, stock, pairs, currencies) job</text><path d="M757.890625,296 h693.109375" class="signal-solid arrow-filled"/><rect width="547.6875" height="18" x="1476.1875" y="316" class="textbg"/><text x="1749.84375" y="325" style="text-anchor: middle; alignment-baseline: central;">Checking that the pairs list is not empty, exit otherwise</text><path d="M1451,311 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="153.625" height="18" x="976.21875" y="350" class="textbg"/><text x="1053.04296875" y="359" style="text-anchor: middle; alignment-baseline: central;">Getting API keys</text><path d="M1451,372 h-795.9140625" class="signal-solid arrow-filled"/><rect width="0" height="0" x="0" y="0" class="textbg"/><text x="1053.04296875" y="397" style="text-anchor: middle; alignment-baseline: central;"/><path d="M655.0859375,392 h795.9140625" class="signal-solid arrow-filled"/><rect width="336.453125" height="18" x="885.015625" y="408" class="textbg"/><text x="1053.04296875" y="417" style="text-anchor: middle; alignment-baseline: central;">Getting the latest balance for user</text><path d="M1451,430 h-795.9140625" class="signal-solid arrow-filled"/><rect width="0" height="0" x="0" y="0" class="textbg"/><text x="1053.04296875" y="455" style="text-anchor: middle; alignment-baseline: central;"/><path d="M655.0859375,450 h795.9140625" class="signal-solid arrow-filled"/><rect width="307.640625" height="18" x="1619.8125" y="466" class="textbg"/><text x="1773.4453125" y="475" style="text-anchor: middle; alignment-baseline: central;">Getting the orders for each pair</text><path d="M1451,488 h644.890625" class="signal-solid arrow-filled"/><rect width="518.875" height="28" x="1471" y="508" class="rect"/><text x="1730.4375" y="522" style="text-anchor: middle; alignment-baseline: central;">Orders are later than the (latest balance, zero time)</text><rect width="269.234375" height="18" x="1639.015625" y="552" class="textbg"/><text x="1773.4453125" y="561" style="text-anchor: middle; alignment-baseline: central;">List of orders for each pair</text><path d="M2095.890625,574 h-644.890625" class="signal-solid arrow-filled"/><rect width="604.890625" height="18" x="1475.984375" y="594" class="textbg"/><text x="1778.4453125" y="603" style="text-anchor: middle; alignment-baseline: central;">Merging orders for each pair, sorting, filtering out non-filled</text><path d="M1451,589 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="403.265625" height="18" x="1476" y="632" class="textbg"/><text x="1677.6328125" y="641" style="text-anchor: middle; alignment-baseline: central;">Grouping orders in the groups by X seconds</text><path d="M1451,627 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="585.6875" height="18" x="1475.984375" y="670" class="textbg"/><text x="1768.84375" y="679" style="text-anchor: middle; alignment-baseline: central;">Processing each order group and updating state for (from, to)</text><path d="M1451,665 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="182.421875" height="18" x="961.828125" y="704" class="textbg"/><text x="1053.04296875" y="713" style="text-anchor: middle; alignment-baseline: central;">Saving new balances</text><path d="M1451,726 h-795.9140625" class="signal-solid arrow-filled"/><rect width="0" height="0" x="0" y="0" class="textbg"/><text x="1053.04296875" y="751" style="text-anchor: middle; alignment-baseline: central;"/><path d="M655.0859375,746 h795.9140625" class="signal-solid arrow-filled"/><rect width="673.109375" height="18" x="767.390625" y="762" class="textbg"/><text x="1104.4453125" y="771" style="text-anchor: middle; alignment-baseline: central;">Adding new job with pairs, which may includes the non-processed orders</text><path d="M1451,784 h-693.109375" class="signal-solid arrow-filled"/></svg>
