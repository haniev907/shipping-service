<svg xmlns="http://www.w3.org/2000/svg" width="2082.1953125" height="1090"><style xmlns="http://www.w3.org/1999/xhtml" type="text/css">
svg text {
  fill: #000;
  stroke: none;
  font-size: 12pt;
  font-family: 'Andale Mono', monospace;
}

svg :not(text) {
  fill: none;
  stroke: #000;
  stroke-width: 2;
}

.textbg {
  fill: #fff;
  stroke: none;
}

.rect {
  fill: #fff;
}

.signal-solid {
  stroke-dasharray: 0;
}

.signal-dotted {
  stroke-dasharray: 5;
}

.arrow-filled {
  marker-end: url(#arrow-filled);
}

.arrow-open {
  marker-end: url(#arrow-open);
}
</style><defs><marker id="arrow-filled" refX="5" refY="2.5" markerWidth="5" markerHeight="5" orient="auto"><path d="M0,0 5,2.5 0,5z" style="stroke: none; fill: #000"/></marker><marker id="arrow-open" refX="5" refY="2.5" markerWidth="5" markerHeight="5" orient="auto"><path d="M0,0 5,2.5 0,5" style="stroke-width: 1"/></marker></defs><rect width="413.65625" height="28" x="10" y="10" class="rect"/><text x="216.828125" y="24" style="text-anchor: middle; alignment-baseline: central;">Rating calculations service - tick fetcher</text><rect width="97.203125" height="38" x="10" y="48" class="rect"/><text x="58.6015625" y="67" style="text-anchor: middle; alignment-baseline: central;">Scheduler</text><rect width="97.203125" height="38" x="10" y="1032" class="rect"/><text x="58.6015625" y="1051" style="text-anchor: middle; alignment-baseline: central;">Scheduler</text><path d="M58.6015625,86 v946" class="timeline"/><rect width="97.203125" height="38" x="318.046875" y="48" class="rect"/><text x="366.6484375" y="67" style="text-anchor: middle; alignment-baseline: central;">Database</text><rect width="97.203125" height="38" x="318.046875" y="1032" class="rect"/><text x="366.6484375" y="1051" style="text-anchor: middle; alignment-baseline: central;">Database</text><path d="M366.6484375,86 v946" class="timeline"/><rect width="78" height="38" x="472.0703125" y="48" class="rect"/><text x="511.0703125" y="67" style="text-anchor: middle; alignment-baseline: central;">Config</text><rect width="78" height="38" x="472.0703125" y="1032" class="rect"/><text x="511.0703125" y="1051" style="text-anchor: middle; alignment-baseline: central;">Config</text><path d="M511.0703125,86 v946" class="timeline"/><rect width="68.40625" height="38" x="570.0703125" y="48" class="rect"/><text x="604.2734375" y="67" style="text-anchor: middle; alignment-baseline: central;">Queue</text><rect width="68.40625" height="38" x="570.0703125" y="1032" class="rect"/><text x="604.2734375" y="1051" style="text-anchor: middle; alignment-baseline: central;">Queue</text><path d="M604.2734375,86 v946" class="timeline"/><rect width="260.4375" height="38" x="916.5234375" y="48" class="rect"/><text x="1046.7421875" y="67" style="text-anchor: middle; alignment-baseline: central;">Currency converter worker</text><rect width="260.4375" height="38" x="916.5234375" y="1032" class="rect"/><text x="1046.7421875" y="1051" style="text-anchor: middle; alignment-baseline: central;">Currency converter worker</text><path d="M1046.7421875,86 v946" class="timeline"/><rect width="79" height="38" x="1326.8984375" y="48" class="rect"/><text x="1366.3984375" y="67" style="text-anchor: middle; alignment-baseline: central;">Worker</text><rect width="79" height="38" x="1326.8984375" y="1032" class="rect"/><text x="1366.3984375" y="1051" style="text-anchor: middle; alignment-baseline: central;">Worker</text><path d="M1366.3984375,86 v946" class="timeline"/><rect width="288.046875" height="18" x="68.59375" y="102" class="textbg"/><text x="212.625" y="111" style="text-anchor: middle; alignment-baseline: central;">Getting the list of valid keys</text><path d="M58.6015625,124 h308.046875" class="signal-solid arrow-filled"/><rect width="249.640625" height="18" x="87.796875" y="140" class="textbg"/><text x="212.625" y="149" style="text-anchor: middle; alignment-baseline: central;">List of (keys, stock name)</text><path d="M366.6484375,162 h-308.046875" class="signal-solid arrow-filled"/><rect width="432.46875" height="18" x="68.796875" y="178" class="textbg"/><text x="284.8359375" y="187" style="text-anchor: middle; alignment-baseline: central;">Getting the list of base currencies for stock</text><path d="M58.6015625,200 h452.46875" class="signal-solid arrow-filled"/><rect width="0" height="0" x="0" y="0" class="textbg"/><text x="284.8359375" y="225" style="text-anchor: middle; alignment-baseline: central;"/><path d="M511.0703125,220 h-452.46875" class="signal-solid arrow-filled"/><rect width="422.46875" height="18" x="120.203125" y="236" class="textbg"/><text x="331.4375" y="245" style="text-anchor: middle; alignment-baseline: central;">Creating jobs for processing (key, currency)</text><path d="M58.6015625,258 h545.671875" class="signal-solid arrow-filled"/><rect width="422.46875" height="18" x="614.265625" y="274" class="textbg"/><text x="825.5078125" y="283" style="text-anchor: middle; alignment-baseline: central;">Creating jobs for processing (key, currency)</text><path d="M1046.7421875,296 h-442.46875" class="signal-solid arrow-filled"/><rect width="307.640625" height="18" x="831.703125" y="312" class="textbg"/><text x="985.3359375" y="321" style="text-anchor: middle; alignment-baseline: central;">Spawning the (key, currency) job</text><path d="M604.2734375,334 h762.125" class="signal-solid arrow-filled"/><rect width="240.4375" height="18" x="746.5" y="350" class="textbg"/><text x="866.5234375" y="359" style="text-anchor: middle; alignment-baseline: central;">Getting the latest rating</text><path d="M1366.3984375,372 h-999.75" class="signal-solid arrow-filled"/><rect width="230.828125" height="18" x="751.296875" y="388" class="textbg"/><text x="866.5234375" y="397" style="text-anchor: middle; alignment-baseline: central;">Latest rating or nothing</text><path d="M366.6484375,410 h999.75" class="signal-solid arrow-filled"/><rect width="317.25" height="28" x="1386.3984375" y="430" class="rect"/><text x="1545.0234375" y="444" style="text-anchor: middle; alignment-baseline: central;">&lt;case-start&gt; If no rating exists</text><rect width="547.28125" height="18" x="592.875" y="474" class="textbg"/><text x="866.5234375" y="483" style="text-anchor: middle; alignment-baseline: central;">Get the oldest balance with converted value in `currency`</text><path d="M1366.3984375,496 h-999.75" class="signal-solid arrow-filled"/><rect width="240.4375" height="18" x="746.5" y="512" class="textbg"/><text x="866.5234375" y="521" style="text-anchor: middle; alignment-baseline: central;">Oldest balance or nothing</text><path d="M366.6484375,534 h999.75" class="signal-solid arrow-filled"/><rect width="394.0625" height="28" x="1386.3984375" y="554" class="rect"/><text x="1583.4296875" y="568" style="text-anchor: middle; alignment-baseline: central;">Exit the execution, if balance not found</text><rect width="346.046875" height="18" x="1391.59375" y="602" class="textbg"/><text x="1564.421875" y="611" style="text-anchor: middle; alignment-baseline: central;">Initialize the tick from the balance</text><path d="M1366.3984375,597 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="336.453125" height="18" x="1391.59375" y="640" class="textbg"/><text x="1559.625" y="649" style="text-anchor: middle; alignment-baseline: central;">Initialize the rating from the tick</text><path d="M1366.3984375,635 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="230.828125" height="18" x="751.296875" y="674" class="textbg"/><text x="866.5234375" y="683" style="text-anchor: middle; alignment-baseline: central;">Save the resulted rating</text><path d="M1366.3984375,696 h-999.75" class="signal-solid arrow-filled"/><rect width="0" height="0" x="0" y="0" class="textbg"/><text x="866.5234375" y="721" style="text-anchor: middle; alignment-baseline: central;"/><path d="M366.6484375,716 h999.75" class="signal-solid arrow-filled"/><rect width="606.296875" height="18" x="1391.09375" y="736" class="textbg"/><text x="1694.546875" y="745" style="text-anchor: middle; alignment-baseline: central;">Add the same job for calculating the next rating value and exit</text><path d="M1366.3984375,731 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="106.015625" height="28" x="1386.3984375" y="774" class="rect"/><text x="1439.40625" y="788" style="text-anchor: middle; alignment-baseline: central;">&lt;case-end&gt;</text><rect width="979.75" height="18" x="376.84375" y="818" class="textbg"/><text x="866.5234375" y="827" style="text-anchor: middle; alignment-baseline: central;">Getting the balance, which is right after the balance which was used for calculating the latest rating</text><path d="M1366.3984375,840 h-999.75" class="signal-solid arrow-filled"/><rect width="566.890625" height="18" x="1391.59375" y="860" class="textbg"/><text x="1674.84375" y="869" style="text-anchor: middle; alignment-baseline: central;">Get the balance value in `currency` and initialize the tick</text><path d="M1366.3984375,855 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="586.09375" height="18" x="1391.59375" y="898" class="textbg"/><text x="1684.4453125" y="907" style="text-anchor: middle; alignment-baseline: central;">Initialize the rating from the latest rating and add the tick</text><path d="M1366.3984375,893 h20 v33 h-20" class="signal-solid arrow-filled"/><rect width="240.4375" height="18" x="746.5" y="932" class="textbg"/><text x="866.5234375" y="941" style="text-anchor: middle; alignment-baseline: central;">Save the new rating value</text><path d="M1366.3984375,954 h-999.75" class="signal-solid arrow-filled"/><rect width="0" height="0" x="0" y="0" class="textbg"/><text x="866.5234375" y="979" style="text-anchor: middle; alignment-baseline: central;"/><path d="M366.6484375,974 h999.75" class="signal-solid arrow-filled"/><rect width="606.296875" height="18" x="1391.09375" y="994" class="textbg"/><text x="1694.546875" y="1003" style="text-anchor: middle; alignment-baseline: central;">Add the same job for calculating the next rating value and exit</text><path d="M1366.3984375,989 h20 v33 h-20" class="signal-solid arrow-filled"/></svg>
